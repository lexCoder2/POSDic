"use strict";(self.webpackChunkretail_pos=self.webpackChunkretail_pos||[]).push([[521],{39:(I,b,o)=>{o.d(b,{h:()=>u});var i=o(4412),R=o(8141),f=o(5312),_=o(375),E=o(6175);let u=(()=>{class g{constructor(a){this.http=a,this.apiUrl=`${f.c.apiUrl}/registers`,this.currentRegisterSubject=new i.t(null),this.currentRegister$=this.currentRegisterSubject.asObservable(),this.loadCurrentRegister()}loadCurrentRegister(){localStorage.getItem("currentRegisterId")&&this.getActiveRegister().subscribe({next:p=>{p?this.currentRegisterSubject.next(p):localStorage.removeItem("currentRegisterId")},error:p=>{console.error("Error loading register from database:",p),localStorage.removeItem("currentRegisterId")}})}getCurrentRegister(){return this.currentRegisterSubject.value}openRegister(a,p){return this.http.post(`${this.apiUrl}/open`,{openingCash:a,registerNumber:p}).pipe((0,R.M)(m=>{this.currentRegisterSubject.next(m),m._id&&localStorage.setItem("currentRegisterId",m._id)}))}closeRegister(a,p,m){return this.http.post(`${this.apiUrl}/${a}/close`,{closingCash:p,notes:m}).pipe((0,R.M)(C=>{this.currentRegisterSubject.next(null),localStorage.removeItem("currentRegisterId")}))}getActiveRegister(){return this.http.get(`${this.apiUrl}/active`).pipe((0,R.M)(a=>{a&&(this.currentRegisterSubject.next(a),a._id&&localStorage.setItem("currentRegisterId",a._id))}))}getRegisterHistory(a,p){let m=`${this.apiUrl}/history`;const C=new URLSearchParams;return a&&C.append("startDate",a.toISOString()),p&&C.append("endDate",p.toISOString()),C.toString()&&(m+=`?${C.toString()}`),this.http.get(m)}getRegisterById(a){return this.http.get(`${this.apiUrl}/${a}`)}deleteRegister(a){return this.http.delete(`${this.apiUrl}/${a}`)}getExpectedCash(){return this.http.get(`${this.apiUrl}/active/expected-cash`)}recordWithdrawal(a,p,m){return this.http.post(`${this.apiUrl}/${a}/withdraw`,{amount:p,reason:m})}static{this.\u0275fac=function(p){return new(p||g)(_.KVO(E.Qq))}}static{this.\u0275prov=_.jDH({token:g,factory:g.\u0275fac,providedIn:"root"})}}return g})()},119:(I,b,o)=>{o.d(b,{o:()=>f});var i=o(5547),R=o(497);let f=(()=>{class _{constructor(u){this.currencyService=u}transform(u,g=2){return null==u||isNaN(u)?`${this.currencyService.getSymbol()}0.00`:this.currencyService.format(u,g)}static{this.\u0275fac=function(g){return new(g||_)(i.rXU(R.P,16))}}static{this.\u0275pipe=i.EJ8({name:"appCurrency",type:_,pure:!1})}}return _})()},7314:(I,b,o)=>{o.d(b,{D:()=>_});var i=o(5547),R=o(7705),f=o(6845);let _=(()=>{class E{constructor(g,e){this.t=g,this.cdr=e,this.t.translationsChanged$.subscribe(()=>{try{this.cdr.markForCheck()}catch{}})}transform(g,e){return this.t.translate(g,e)}static{this.\u0275fac=function(e){return new(e||E)(i.rXU(f.L,16),i.rXU(R.gRc,16))}}static{this.\u0275pipe=i.EJ8({name:"translate",type:E,pure:!1})}}return E})()},7521:(I,b,o)=>{o.d(b,{RegistersComponent:()=>Y});var i=o(375),R=o(9769),f=o(4341),_=o(1413),E=o(7314),u=o(119),g=o(8659),e=o(5547),a=o(7705),p=o(39),m=o(4796),C=o(8397);const O=(s,l)=>({positive:s,negative:l});function T(s,l){1&s&&(e.j41(0,"div",22),e.nrm(1,"div",23),e.j41(2,"p"),e.EFF(3),e.nI1(4,"translate"),e.k0s()()),2&s&&(e.R7$(3),e.JRh(e.bMT(4,1,"REGISTER.LOADING")))}function P(s,l){1&s&&(e.j41(0,"span",36),e.nI1(1,"translate"),e.nrm(2,"i",37),e.EFF(3),e.nI1(4,"translate"),e.k0s()),2&s&&(e.Y8G("title",e.mNQ(e.bMT(1,3,"REGISTER.AUTO_CLOSED_TOOLTIP"))),e.R7$(3),e.SpI(" ",e.bMT(4,5,"REGISTER.AUTO_CLOSED")," "))}function v(s,l){if(1&s){const t=e.RV6();e.j41(0,"button",38),e.bIt("click",function(){i.eBV(t);const n=e.XpG().$implicit,c=e.XpG(2);return i.Njj(c.confirmDelete(n))}),e.nrm(1,"i",39),e.k0s()}}function x(s,l){if(1&s){const t=e.RV6();e.j41(0,"tr")(1,"td"),e.EFF(2),e.k0s(),e.j41(3,"td"),e.EFF(4),e.k0s(),e.j41(5,"td"),e.EFF(6),e.nI1(7,"date"),e.k0s(),e.j41(8,"td"),e.EFF(9),e.nI1(10,"date"),e.k0s(),e.j41(11,"td"),e.EFF(12),e.k0s(),e.j41(13,"td",28),e.EFF(14),e.nI1(15,"appCurrency"),e.k0s(),e.j41(16,"td",28),e.EFF(17),e.nI1(18,"number"),e.k0s(),e.j41(19,"td",29),e.EFF(20),e.nI1(21,"number"),e.k0s(),e.j41(22,"td",28),e.EFF(23),e.nI1(24,"number"),e.k0s(),e.j41(25,"td")(26,"span",30),e.EFF(27),e.nI1(28,"translate"),e.nI1(29,"translate"),e.k0s(),e.DNE(30,P,5,7,"span",31),e.k0s(),e.j41(31,"td",32)(32,"button",33),e.bIt("click",function(){const n=i.eBV(t).$implicit,c=e.XpG(2);return i.Njj(c.viewDetails(n))}),e.nrm(33,"i",34),e.k0s(),e.DNE(34,v,2,0,"button",35),e.k0s()()}if(2&s){const t=l.$implicit,r=e.XpG(2);e.R7$(2),e.JRh(t.registerNumber),e.R7$(2),e.JRh(r.getOpenedByName(t)),e.R7$(2),e.JRh(e.i5U(7,14,t.openedAt,"short")),e.R7$(3),e.JRh(t.closedAt?e.i5U(10,17,t.closedAt,"short"):"-"),e.R7$(3),e.JRh(r.calculateDuration(t)),e.R7$(2),e.JRh(e.bMT(15,20,t.openingCash)),e.R7$(3),e.JRh(t.closingCash?"$"+e.i5U(18,22,t.closingCash,"1.2-2"):"-"),e.R7$(2),e.Y8G("ngClass",e.l_i(35,O,t.cashDifference&&t.cashDifference>0,t.cashDifference&&t.cashDifference<0)),e.R7$(),e.SpI(" ",null!=t.cashDifference?"$"+e.i5U(21,25,t.cashDifference,"1.2-2"):"-"," "),e.R7$(3),e.JRh(t.totalSales?"$"+e.i5U(24,28,t.totalSales,"1.2-2"):"-"),e.R7$(3),e.Y8G("ngClass",t.status),e.R7$(),e.SpI(" ","open"===t.status?e.bMT(28,31,"REGISTER.OPEN"):e.bMT(29,33,"REGISTER.CLOSED")," "),e.R7$(3),e.Y8G("ngIf",t.isAutoClose),e.R7$(4),e.Y8G("ngIf","admin"===(null==r.currentUser?null:r.currentUser.role))}}function F(s,l){1&s&&(e.j41(0,"tr")(1,"td",40),e.EFF(2),e.nI1(3,"translate"),e.k0s()()),2&s&&(e.R7$(2),e.SpI(" ",e.bMT(3,1,"REGISTER.NO_REGISTERS")," "))}function S(s,l){if(1&s&&(e.j41(0,"div",24)(1,"table",25)(2,"thead")(3,"tr")(4,"th"),e.EFF(5),e.nI1(6,"translate"),e.k0s(),e.j41(7,"th"),e.EFF(8),e.nI1(9,"translate"),e.k0s(),e.j41(10,"th"),e.EFF(11),e.nI1(12,"translate"),e.k0s(),e.j41(13,"th"),e.EFF(14),e.nI1(15,"translate"),e.k0s(),e.j41(16,"th"),e.EFF(17),e.nI1(18,"translate"),e.k0s(),e.j41(19,"th"),e.EFF(20),e.nI1(21,"translate"),e.k0s(),e.j41(22,"th"),e.EFF(23),e.nI1(24,"translate"),e.k0s(),e.j41(25,"th"),e.EFF(26),e.nI1(27,"translate"),e.k0s(),e.j41(28,"th"),e.EFF(29),e.nI1(30,"translate"),e.k0s(),e.j41(31,"th"),e.EFF(32),e.nI1(33,"translate"),e.k0s(),e.j41(34,"th"),e.EFF(35),e.nI1(36,"translate"),e.k0s()()(),e.j41(37,"tbody"),e.DNE(38,x,35,38,"tr",26)(39,F,4,3,"tr",27),e.k0s()()()),2&s){const t=e.XpG();e.R7$(5),e.JRh(e.bMT(6,13,"REGISTER.NUMBER")),e.R7$(3),e.JRh(e.bMT(9,15,"REGISTER.OPENED_BY")),e.R7$(3),e.JRh(e.bMT(12,17,"REGISTER.OPENED_AT")),e.R7$(3),e.JRh(e.bMT(15,19,"REGISTER.CLOSED_AT")),e.R7$(3),e.JRh(e.bMT(18,21,"REGISTER.DURATION")),e.R7$(3),e.JRh(e.bMT(21,23,"REGISTER.OPENING_CASH")),e.R7$(3),e.JRh(e.bMT(24,25,"REGISTER.CLOSING_CASH")),e.R7$(3),e.JRh(e.bMT(27,27,"REGISTER.DIFFERENCE")),e.R7$(3),e.JRh(e.bMT(30,29,"REGISTER.TOTAL_SALES")),e.R7$(3),e.JRh(e.bMT(33,31,"REGISTER.STATUS")),e.R7$(3),e.JRh(e.bMT(36,33,"REGISTER.ACTIONS")),e.R7$(3),e.Y8G("ngForOf",t.paginatedRegisters),e.R7$(),e.Y8G("ngIf",0===t.paginatedRegisters.length)}}function D(s,l){if(1&s){const t=e.RV6();e.j41(0,"div",41)(1,"button",42),e.bIt("click",function(){i.eBV(t);const n=e.XpG();return i.Njj(n.previousPage())}),e.nrm(2,"i",43),e.k0s(),e.j41(3,"span",44),e.EFF(4),e.nI1(5,"translate"),e.nI1(6,"translate"),e.nI1(7,"translate"),e.k0s(),e.j41(8,"button",42),e.bIt("click",function(){i.eBV(t);const n=e.XpG();return i.Njj(n.nextPage())}),e.nrm(9,"i",45),e.k0s()()}if(2&s){const t=e.XpG();e.R7$(),e.Y8G("disabled",1===t.currentPage),e.R7$(3),e.ZXR(" ",e.bMT(5,8,"REGISTER.PAGE")," ",t.currentPage," ",e.bMT(6,10,"REGISTER.OF")," ",t.totalPages," (",t.filteredRegisters.length," ",e.bMT(7,12,"REGISTER.TOTAL"),") "),e.R7$(4),e.Y8G("disabled",t.currentPage===t.totalPages)}}function y(s,l){if(1&s&&(e.j41(0,"div",54)(1,"label"),e.EFF(2),e.nI1(3,"translate"),e.k0s(),e.j41(4,"span"),e.EFF(5),e.k0s()()),2&s){const t=e.XpG(3);e.R7$(2),e.JRh(e.bMT(3,2,"REGISTER.CLOSED_BY")),e.R7$(3),e.JRh(t.getClosedByName(t.selectedRegister))}}function k(s,l){if(1&s&&(e.j41(0,"div",54)(1,"label"),e.EFF(2),e.nI1(3,"translate"),e.k0s(),e.j41(4,"span"),e.EFF(5),e.nI1(6,"date"),e.k0s()()),2&s){const t=e.XpG(3);e.R7$(2),e.JRh(e.bMT(3,2,"REGISTER.CLOSED_AT")),e.R7$(3),e.JRh(e.i5U(6,4,t.selectedRegister.closedAt,"medium"))}}function j(s,l){if(1&s&&(e.j41(0,"div",54)(1,"label"),e.EFF(2),e.nI1(3,"translate"),e.k0s(),e.j41(4,"span",28),e.EFF(5),e.nI1(6,"appCurrency"),e.k0s()()),2&s){const t=e.XpG(3);e.R7$(2),e.JRh(e.bMT(3,2,"REGISTER.CLOSING_CASH")),e.R7$(3),e.JRh(e.bMT(6,4,t.selectedRegister.closingCash))}}function $(s,l){if(1&s&&(e.j41(0,"div",54)(1,"label"),e.EFF(2),e.nI1(3,"translate"),e.k0s(),e.j41(4,"span",28),e.EFF(5),e.nI1(6,"appCurrency"),e.k0s()()),2&s){const t=e.XpG(3);e.R7$(2),e.JRh(e.bMT(3,2,"REGISTER.EXPECTED_CASH")),e.R7$(3),e.JRh(e.bMT(6,4,t.selectedRegister.expectedCash))}}function G(s,l){if(1&s&&(e.j41(0,"div",54)(1,"label"),e.EFF(2),e.nI1(3,"translate"),e.k0s(),e.j41(4,"span",29),e.EFF(5),e.nI1(6,"appCurrency"),e.k0s()()),2&s){const t=e.XpG(3);e.R7$(2),e.JRh(e.bMT(3,3,"REGISTER.DIFFERENCE")),e.R7$(2),e.Y8G("ngClass",e.l_i(7,O,t.selectedRegister.cashDifference>0,t.selectedRegister.cashDifference<0)),e.R7$(),e.SpI(" ",e.bMT(6,5,t.selectedRegister.cashDifference)," ")}}function w(s,l){if(1&s&&(e.j41(0,"div",54)(1,"label"),e.EFF(2),e.nI1(3,"translate"),e.k0s(),e.j41(4,"span",28),e.EFF(5),e.nI1(6,"appCurrency"),e.k0s()()),2&s){const t=e.XpG(3);e.R7$(2),e.JRh(e.bMT(3,2,"REGISTER.TOTAL_SALES")),e.R7$(3),e.JRh(e.bMT(6,4,t.selectedRegister.totalSales))}}function A(s,l){if(1&s&&(e.j41(0,"div",54)(1,"label"),e.EFF(2),e.nI1(3,"translate"),e.k0s(),e.j41(4,"span"),e.EFF(5),e.k0s()()),2&s){const t=e.XpG(3);e.R7$(2),e.JRh(e.bMT(3,2,"REGISTER.TOTAL_TRANSACTIONS")),e.R7$(3),e.JRh(t.selectedRegister.totalTransactions)}}function N(s,l){if(1&s&&(e.j41(0,"div",57)(1,"label"),e.EFF(2),e.nI1(3,"translate"),e.k0s(),e.j41(4,"p",58),e.EFF(5),e.k0s()()),2&s){const t=e.XpG(3);e.R7$(2),e.JRh(e.bMT(3,2,"REGISTER.NOTES")),e.R7$(3),e.JRh(t.selectedRegister.notes)}}function B(s,l){if(1&s&&(e.j41(0,"div",52)(1,"div",53)(2,"div",54)(3,"label"),e.EFF(4),e.nI1(5,"translate"),e.k0s(),e.j41(6,"span"),e.EFF(7),e.k0s()(),e.j41(8,"div",54)(9,"label"),e.EFF(10),e.nI1(11,"translate"),e.k0s(),e.j41(12,"span",30),e.EFF(13),e.nI1(14,"translate"),e.nI1(15,"translate"),e.k0s()(),e.j41(16,"div",54)(17,"label"),e.EFF(18),e.nI1(19,"translate"),e.k0s(),e.j41(20,"span"),e.EFF(21),e.k0s()(),e.j41(22,"div",54)(23,"label"),e.EFF(24),e.nI1(25,"translate"),e.k0s(),e.j41(26,"span"),e.EFF(27),e.nI1(28,"date"),e.k0s()(),e.DNE(29,y,6,4,"div",55)(30,k,7,7,"div",55),e.j41(31,"div",54)(32,"label"),e.EFF(33),e.nI1(34,"translate"),e.k0s(),e.j41(35,"span",28),e.EFF(36),e.nI1(37,"appCurrency"),e.k0s()(),e.DNE(38,j,7,6,"div",55)(39,$,7,6,"div",55)(40,G,7,10,"div",55)(41,w,7,6,"div",55)(42,A,6,4,"div",55)(43,N,6,4,"div",56),e.k0s()()),2&s){const t=e.XpG(2);e.R7$(4),e.JRh(e.bMT(5,19,"REGISTER.NUMBER")),e.R7$(3),e.JRh(t.selectedRegister.registerNumber),e.R7$(3),e.JRh(e.bMT(11,21,"REGISTER.STATUS")),e.R7$(2),e.Y8G("ngClass",t.selectedRegister.status),e.R7$(),e.SpI(" ","open"===t.selectedRegister.status?e.bMT(14,23,"REGISTER.OPEN"):e.bMT(15,25,"REGISTER.CLOSED")," "),e.R7$(5),e.JRh(e.bMT(19,27,"REGISTER.OPENED_BY")),e.R7$(3),e.JRh(t.getOpenedByName(t.selectedRegister)),e.R7$(3),e.JRh(e.bMT(25,29,"REGISTER.OPENED_AT")),e.R7$(3),e.JRh(e.i5U(28,31,t.selectedRegister.openedAt,"medium")),e.R7$(2),e.Y8G("ngIf",t.selectedRegister.closedBy),e.R7$(),e.Y8G("ngIf",t.selectedRegister.closedAt),e.R7$(3),e.JRh(e.bMT(34,34,"REGISTER.OPENING_CASH")),e.R7$(3),e.JRh(e.bMT(37,36,t.selectedRegister.openingCash)),e.R7$(2),e.Y8G("ngIf",null!=t.selectedRegister.closingCash),e.R7$(),e.Y8G("ngIf",null!=t.selectedRegister.expectedCash),e.R7$(),e.Y8G("ngIf",null!=t.selectedRegister.cashDifference),e.R7$(),e.Y8G("ngIf",null!=t.selectedRegister.totalSales),e.R7$(),e.Y8G("ngIf",null!=t.selectedRegister.totalTransactions),e.R7$(),e.Y8G("ngIf",t.selectedRegister.notes)}}function U(s,l){if(1&s){const t=e.RV6();e.j41(0,"div",46),e.bIt("click",function(){i.eBV(t);const n=e.XpG();return i.Njj(n.closeDetailModal())}),e.j41(1,"div",47),e.bIt("click",function(n){return i.eBV(t),i.Njj(n.stopPropagation())}),e.j41(2,"div",48)(3,"h2"),e.EFF(4),e.nI1(5,"translate"),e.k0s(),e.j41(6,"button",49),e.bIt("click",function(){i.eBV(t);const n=e.XpG();return i.Njj(n.closeDetailModal())}),e.EFF(7,"\u2715"),e.k0s()(),e.DNE(8,B,44,38,"div",50),e.j41(9,"div",51)(10,"button",4),e.bIt("click",function(){i.eBV(t);const n=e.XpG();return i.Njj(n.closeDetailModal())}),e.EFF(11),e.nI1(12,"translate"),e.k0s()()()()}if(2&s){const t=e.XpG();e.R7$(4),e.JRh(e.bMT(5,3,"REGISTER.DETAILS")),e.R7$(4),e.Y8G("ngIf",t.selectedRegister),e.R7$(3),e.SpI(" ",e.bMT(12,5,"REGISTER.CLOSE")," ")}}function L(s,l){if(1&s&&(e.j41(0,"p")(1,"strong"),e.EFF(2),e.k0s()()),2&s){const t=e.XpG(2);e.R7$(2),e.JRh(t.selectedRegister.registerNumber)}}function J(s,l){if(1&s){const t=e.RV6();e.j41(0,"div",46),e.bIt("click",function(){i.eBV(t);const n=e.XpG();return i.Njj(n.cancelDelete())}),e.j41(1,"div",59),e.bIt("click",function(n){return i.eBV(t),i.Njj(n.stopPropagation())}),e.j41(2,"div",48)(3,"h2"),e.EFF(4),e.nI1(5,"translate"),e.k0s(),e.j41(6,"button",49),e.bIt("click",function(){i.eBV(t);const n=e.XpG();return i.Njj(n.cancelDelete())}),e.EFF(7,"\u2715"),e.k0s()(),e.j41(8,"div",52)(9,"p"),e.EFF(10),e.nI1(11,"translate"),e.k0s(),e.DNE(12,L,3,1,"p",27),e.k0s(),e.j41(13,"div",51)(14,"button",60),e.bIt("click",function(){i.eBV(t);const n=e.XpG();return i.Njj(n.cancelDelete())}),e.EFF(15),e.nI1(16,"translate"),e.k0s(),e.j41(17,"button",61),e.bIt("click",function(){i.eBV(t);const n=e.XpG();return i.Njj(n.deleteRegister())}),e.EFF(18),e.nI1(19,"translate"),e.k0s()()()()}if(2&s){const t=e.XpG();e.R7$(4),e.JRh(e.bMT(5,5,"REGISTER.CONFIRM_DELETE")),e.R7$(6),e.JRh(e.bMT(11,7,"REGISTER.DELETE_WARNING")),e.R7$(2),e.Y8G("ngIf",t.selectedRegister),e.R7$(3),e.SpI(" ",e.bMT(16,9,"REGISTER.CANCEL")," "),e.R7$(3),e.SpI(" ",e.bMT(19,11,"REGISTER.DELETE")," ")}}let Y=(()=>{class s{constructor(t,r,n,c){this.registerService=t,this.authService=r,this.toastService=n,this.cdr=c,this.registers=[],this.filteredRegisters=[],this.currentUser=null,this.loading=!1,this.filterStatus="all",this.filterStartDate="",this.filterEndDate="",this.searchQuery="",this.showDetailModal=(0,i.vPA)(!1),this.showDeleteConfirm=(0,i.vPA)(!1),this.selectedRegister=null,this.currentPage=1,this.pageSize=20,this.totalPages=1,this.destroy$=new _.B}ngOnInit(){this.currentUser=this.authService.getCurrentUser(),this.loadRegisters()}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}loadRegisters(){this.loading=!0;const t=this.filterStartDate?new Date(this.filterStartDate):void 0,r=this.filterEndDate?new Date(this.filterEndDate):void 0;this.registerService.getRegisterHistory(t,r).subscribe({next:n=>{this.registers=n,this.applyFilters(),this.loading=!1,this.cdr.markForCheck()},error:n=>{console.error("Error loading registers:",n),this.toastService.show("Error loading registers","error"),this.loading=!1,this.cdr.markForCheck()}})}applyFilters(){let t=[...this.registers];if("all"!==this.filterStatus&&(t=t.filter(r=>r.status===this.filterStatus)),this.searchQuery.trim()){const r=this.searchQuery.toLowerCase();t=t.filter(n=>n.registerNumber.toLowerCase().includes(r)||"string"!=typeof n.openedBy&&n.openedBy?.firstName?.toLowerCase().includes(r)||"string"!=typeof n.openedBy&&n.openedBy?.lastName?.toLowerCase().includes(r)||"string"!=typeof n.closedBy&&n.closedBy?.firstName?.toLowerCase().includes(r))}this.filteredRegisters=t,this.totalPages=Math.ceil(this.filteredRegisters.length/this.pageSize),this.currentPage=1,this.cdr.markForCheck()}get paginatedRegisters(){const t=(this.currentPage-1)*this.pageSize;return this.filteredRegisters.slice(t,t+this.pageSize)}onFilterChange(){this.applyFilters()}onDateFilterChange(){this.loadRegisters()}clearFilters(){this.filterStatus="all",this.filterStartDate="",this.filterEndDate="",this.searchQuery="",this.loadRegisters()}viewDetails(t){this.selectedRegister=t,this.showDetailModal.set(!0)}closeDetailModal(){this.showDetailModal.set(!1),this.selectedRegister=null}confirmDelete(t){this.selectedRegister=t,this.showDeleteConfirm.set(!0)}cancelDelete(){this.showDeleteConfirm.set(!1),this.selectedRegister=null}deleteRegister(){this.selectedRegister?._id&&this.registerService.deleteRegister(this.selectedRegister._id).subscribe({next:r=>{this.toastService.show(r.message||"Register deleted successfully","success"),this.showDeleteConfirm.set(!1),this.selectedRegister=null,this.loadRegisters()},error:r=>{console.error("Error deleting register:",r),this.toastService.show(r.error?.message||"Error deleting register","error"),this.showDeleteConfirm.set(!1)}})}nextPage(){this.currentPage<this.totalPages&&this.currentPage++}previousPage(){this.currentPage>1&&this.currentPage--}goToPage(t){t>=1&&t<=this.totalPages&&(this.currentPage=t)}getOpenedByName(t){if("string"==typeof t.openedBy)return t.openedBy;const r=t.openedBy;return r.firstName?`${r.firstName} ${r.lastName||""}`:r.username}getClosedByName(t){if(!t.closedBy)return"-";if("string"==typeof t.closedBy)return t.closedBy;const r=t.closedBy;return r.firstName?`${r.firstName} ${r.lastName||""}`:r.username}calculateDuration(t){if(!t.closedAt)return"Still open";const r=new Date(t.openedAt),c=new Date(t.closedAt).getTime()-r.getTime(),d=Math.floor(c/36e5),M=Math.floor(c%36e5/6e4);return d>0?`${d}h ${M}m`:`${M}m`}exportToCSV(){const n=[["Register Number","Opened By","Opened At","Closed By","Closed At","Opening Cash","Closing Cash","Expected Cash","Cash Difference","Total Sales","Transactions","Status"],...this.filteredRegisters.map(h=>[h.registerNumber,this.getOpenedByName(h),new Date(h.openedAt).toLocaleString(),this.getClosedByName(h),h.closedAt?new Date(h.closedAt).toLocaleString():"",h.openingCash.toFixed(2),h.closingCash?.toFixed(2)||"",h.expectedCash?.toFixed(2)||"",h.cashDifference?.toFixed(2)||"",h.totalSales?.toFixed(2)||"",h.totalTransactions||"",h.status])].map(h=>h.join(",")).join("\n"),c=new Blob([n],{type:"text/csv"}),d=window.URL.createObjectURL(c),M=document.createElement("a");M.href=d,M.download=`registers_${(new Date).toISOString().split("T")[0]}.csv`,M.click(),window.URL.revokeObjectURL(d)}static{this.\u0275fac=function(r){return new(r||s)(e.rXU(p.h),e.rXU(m.u),e.rXU(C.f),e.rXU(a.gRc))}}static{this.\u0275cmp=e.VBU({type:s,selectors:[["app-registers"]],decls:52,vars:46,consts:[["icon","fas fa-cash-register",3,"title"],[1,"header-actions"],[1,"btn","btn-secondary",3,"click","disabled"],[1,"fas","fa-file-export"],[1,"btn","btn-primary",3,"click"],[1,"fas","fa-sync-alt"],[1,"registers-container"],[1,"filters-section"],[1,"filter-row"],[1,"filter-group"],[1,"filter-select",3,"ngModelChange","change","ngModel"],["value","all"],["value","open"],["value","closed"],["type","date",1,"filter-input",3,"ngModelChange","change","ngModel"],[1,"filter-group","filter-search"],["type","text",1,"filter-input",3,"ngModelChange","input","ngModel","placeholder"],[1,"btn","btn-secondary","btn-clear",3,"click"],["class","loading-state",4,"ngIf"],["class","table-container",4,"ngIf"],["class","pagination",4,"ngIf"],["class","modal-overlay",3,"click",4,"ngIf"],[1,"loading-state"],[1,"spinner"],[1,"table-container"],[1,"registers-table"],[4,"ngFor","ngForOf"],[4,"ngIf"],[1,"currency"],[1,"currency",3,"ngClass"],[1,"status-badge",3,"ngClass"],["class","auto-close-badge",3,"title",4,"ngIf"],[1,"actions"],["title","View Details",1,"btn-icon",3,"click"],[1,"fas","fa-eye"],["class","btn-icon btn-danger","title","Delete",3,"click",4,"ngIf"],[1,"auto-close-badge",3,"title"],[1,"fas","fa-robot"],["title","Delete",1,"btn-icon","btn-danger",3,"click"],[1,"fas","fa-trash-alt"],["colspan","11",1,"no-data"],[1,"pagination"],[1,"btn","btn-secondary","btn-sm",3,"click","disabled"],[1,"fas","fa-chevron-left"],[1,"page-info"],[1,"fas","fa-chevron-right"],[1,"modal-overlay",3,"click"],[1,"modal-content",3,"click"],[1,"modal-header"],[1,"btn-close",3,"click"],["class","modal-body",4,"ngIf"],[1,"modal-footer"],[1,"modal-body"],[1,"detail-grid"],[1,"detail-item"],["class","detail-item",4,"ngIf"],["class","detail-item full-width",4,"ngIf"],[1,"detail-item","full-width"],[1,"notes"],[1,"modal-content","modal-confirm",3,"click"],[1,"btn","btn-secondary",3,"click"],[1,"btn","btn-danger",3,"click"]],template:function(r,n){1&r&&(e.j41(0,"app-page-title",0),e.nI1(1,"translate"),e.j41(2,"div",1)(3,"button",2),e.bIt("click",function(){return n.exportToCSV()}),e.nrm(4,"i",3),e.EFF(5),e.nI1(6,"translate"),e.k0s(),e.j41(7,"button",4),e.bIt("click",function(){return n.loadRegisters()}),e.nrm(8,"i",5),e.EFF(9),e.nI1(10,"translate"),e.k0s()()(),e.j41(11,"div",6)(12,"div",7)(13,"div",8)(14,"div",9)(15,"label"),e.EFF(16),e.nI1(17,"translate"),e.k0s(),e.j41(18,"select",10),e.mxI("ngModelChange",function(d){return e.DH7(n.filterStatus,d)||(n.filterStatus=d),d}),e.bIt("change",function(){return n.onFilterChange()}),e.j41(19,"option",11),e.EFF(20),e.nI1(21,"translate"),e.k0s(),e.j41(22,"option",12),e.EFF(23),e.nI1(24,"translate"),e.k0s(),e.j41(25,"option",13),e.EFF(26),e.nI1(27,"translate"),e.k0s()()(),e.j41(28,"div",9)(29,"label"),e.EFF(30),e.nI1(31,"translate"),e.k0s(),e.j41(32,"input",14),e.mxI("ngModelChange",function(d){return e.DH7(n.filterStartDate,d)||(n.filterStartDate=d),d}),e.bIt("change",function(){return n.onDateFilterChange()}),e.k0s()(),e.j41(33,"div",9)(34,"label"),e.EFF(35),e.nI1(36,"translate"),e.k0s(),e.j41(37,"input",14),e.mxI("ngModelChange",function(d){return e.DH7(n.filterEndDate,d)||(n.filterEndDate=d),d}),e.bIt("change",function(){return n.onDateFilterChange()}),e.k0s()(),e.j41(38,"div",15)(39,"label"),e.EFF(40),e.nI1(41,"translate"),e.k0s(),e.j41(42,"input",16),e.nI1(43,"translate"),e.mxI("ngModelChange",function(d){return e.DH7(n.searchQuery,d)||(n.searchQuery=d),d}),e.bIt("input",function(){return n.onFilterChange()}),e.k0s()(),e.j41(44,"button",17),e.bIt("click",function(){return n.clearFilters()}),e.EFF(45),e.nI1(46,"translate"),e.k0s()()(),e.DNE(47,T,5,3,"div",18)(48,S,40,35,"div",19)(49,D,10,14,"div",20),e.k0s(),e.DNE(50,U,13,7,"div",21)(51,J,20,13,"div",21)),2&r&&(e.Y8G("title",e.bMT(1,22,"REGISTER.HISTORY")),e.R7$(3),e.Y8G("disabled",0===n.filteredRegisters.length),e.R7$(2),e.SpI(" ",e.bMT(6,24,"REGISTER.EXPORT")," "),e.R7$(4),e.SpI(" ",e.bMT(10,26,"REGISTER.REFRESH")," "),e.R7$(7),e.JRh(e.bMT(17,28,"REGISTER.STATUS")),e.R7$(2),e.R50("ngModel",n.filterStatus),e.R7$(2),e.JRh(e.bMT(21,30,"REGISTER.ALL")),e.R7$(3),e.JRh(e.bMT(24,32,"REGISTER.OPEN")),e.R7$(3),e.JRh(e.bMT(27,34,"REGISTER.CLOSED")),e.R7$(4),e.JRh(e.bMT(31,36,"REGISTER.START_DATE")),e.R7$(2),e.R50("ngModel",n.filterStartDate),e.R7$(3),e.JRh(e.bMT(36,38,"REGISTER.END_DATE")),e.R7$(2),e.R50("ngModel",n.filterEndDate),e.R7$(3),e.JRh(e.bMT(41,40,"REGISTER.SEARCH")),e.R7$(2),e.R50("ngModel",n.searchQuery),e.Y8G("placeholder",e.bMT(43,42,"REGISTER.SEARCH_PLACEHOLDER")),e.R7$(3),e.SpI(" ",e.bMT(46,44,"REGISTER.CLEAR_FILTERS")," "),e.R7$(2),e.Y8G("ngIf",n.loading),e.R7$(),e.Y8G("ngIf",!n.loading),e.R7$(),e.Y8G("ngIf",!n.loading&&n.totalPages>1),e.R7$(),e.Y8G("ngIf",n.showDetailModal()),e.R7$(),e.Y8G("ngIf",n.showDeleteConfirm()))},dependencies:[R.MD,R.YU,R.Sq,R.bT,f.YN,f.xH,f.y7,f.me,f.wz,f.BC,f.vS,g.j,R.QX,R.vh,E.D,u.o],styles:['@import"https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap";.dark-theme[_ngcontent-%COMP%]{--neumorphic-bg: #1a1d24;--neumorphic-surface: #222831;--text-primary: #e5e7eb;--text-secondary: #9ca3af;--text-muted: #6b7280;--bg-primary: #1a1d24;--bg-secondary: #222831;--bg-tertiary: #2d3139;--bg-hover: #3a3f4b;--bg-active: #4a5161;--border-color: #3a3f4b;--card-bg: #222831;--input-bg: #2d3139;--sidebar-text: rgba(255, 255, 255, .7);--sidebar-text-active: #ffffff;--shadow-neumorphic: 6px 6px 12px rgba(0, 0, 0, .4), -6px -6px 12px rgba(255, 255, 255, .02);--shadow-neumorphic-sm: 3px 3px 6px rgba(0, 0, 0, .3), -3px -3px 6px rgba(255, 255, 255, .02);--shadow-neumorphic-lg: 9px 9px 16px rgba(0, 0, 0, .5), -9px -9px 16px rgba(255, 255, 255, .03);--shadow-neumorphic-inset: inset 3px 3px 6px rgba(0, 0, 0, .3), inset -3px -3px 6px rgba(255, 255, 255, .02);background-color:var(--bg-primary);color:var(--text-primary)}.registers-container[_ngcontent-%COMP%]{padding:0 2rem;max-width:1600px;margin:0 auto}.page-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:2rem}.page-header[_ngcontent-%COMP%]   .header-actions[_ngcontent-%COMP%]{display:flex;gap:1rem}.filters-section[_ngcontent-%COMP%]{background:#ffffffd9;padding:1.5rem;border-radius:12px;margin-bottom:2rem;box-shadow:0 2px 4px #0000000a}.filter-row[_ngcontent-%COMP%]{display:flex;gap:1rem;align-items:flex-end;flex-wrap:wrap}.filter-group[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.5rem}.filter-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-size:.875rem;font-weight:500;color:#595959}.filter-group.filter-search[_ngcontent-%COMP%]{flex:1;min-width:250px}.filter-select[_ngcontent-%COMP%], .filter-input[_ngcontent-%COMP%]{padding:.5rem;border:1px solid #e5e7eb;border-radius:4px;background:#5a5959;color:#262626;font-size:.875rem;transition:.2s ease}.filter-select[_ngcontent-%COMP%]:focus, .filter-input[_ngcontent-%COMP%]:focus{outline:none;border-color:#2d1674;box-shadow:0 4px 12px #2d167433}.filter-select[_ngcontent-%COMP%]{min-width:150px}.btn-clear[_ngcontent-%COMP%]{align-self:flex-end}.loading-state[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:4rem 2rem;gap:1rem}.loading-state[_ngcontent-%COMP%]   .spinner[_ngcontent-%COMP%]{width:40px;height:40px;border:4px solid #e5e7eb;border-top-color:#2d1674;border-radius:9999px;animation:_ngcontent-%COMP%_spin 1s linear infinite}.loading-state[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#595959;font-size:.875rem}@keyframes _ngcontent-%COMP%_spin{to{transform:rotate(360deg)}}.table-container[_ngcontent-%COMP%]{background:#ffffffd9;border-radius:12px;overflow:hidden;box-shadow:0 2px 4px #0000000a}.registers-table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse}.registers-table[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]{background:#fff}.registers-table[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{padding:1rem;text-align:left;font-size:.75rem;font-weight:600;color:#595959;text-transform:uppercase;letter-spacing:.05em;border-bottom:2px solid #e5e7eb}.registers-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{border-bottom:1px solid #e5e7eb;transition:.2s ease}.registers-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:hover{background:#0000000a}.registers-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:last-child{border-bottom:none}.registers-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:1rem;font-size:.875rem;color:#262626}.registers-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   td.currency[_ngcontent-%COMP%]{font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-weight:500}.registers-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   td.currency.positive[_ngcontent-%COMP%]{color:#48bb78}.registers-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   td.currency.negative[_ngcontent-%COMP%]{color:#f56565}.registers-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   td.no-data[_ngcontent-%COMP%]{text-align:center;padding:3rem;color:#595959;font-style:italic}.status-badge[_ngcontent-%COMP%]{display:inline-block;padding:.25rem .75rem;border-radius:9999px;font-size:.75rem;font-weight:600;text-transform:uppercase;letter-spacing:.05em}.status-badge.open[_ngcontent-%COMP%]{background:#48bb781a;color:#48bb78}.status-badge.closed[_ngcontent-%COMP%]{background:#6b72801a;color:#6b7280}.auto-close-badge[_ngcontent-%COMP%]{display:inline-flex;align-items:center;gap:.25rem;margin-left:.5rem;padding:.25rem .5rem;border-radius:8px;font-size:.75rem;font-weight:500;background:#ed893626;color:#dd6b20;border:1px solid rgba(237,137,54,.3)}.auto-close-badge[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:.9em}.actions[_ngcontent-%COMP%]{display:flex;gap:.5rem}.btn-icon[_ngcontent-%COMP%]{background:transparent;border:none;padding:.5rem;cursor:pointer;border-radius:4px;transition:.2s ease;display:inline-flex;align-items:center;justify-content:center}.btn-icon[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:1rem;color:#595959}.btn-icon[_ngcontent-%COMP%]:hover{background:#0000000a}.btn-icon[_ngcontent-%COMP%]:hover   i[_ngcontent-%COMP%]{color:#262626}.btn-icon.btn-danger[_ngcontent-%COMP%]:hover{background:#f565651a}.btn-icon.btn-danger[_ngcontent-%COMP%]:hover   i[_ngcontent-%COMP%]{color:#f56565}.pagination[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;gap:1rem;margin-top:2rem}.pagination[_ngcontent-%COMP%]   .page-info[_ngcontent-%COMP%]{font-size:.875rem;color:#595959}.btn[_ngcontent-%COMP%]{padding:.5rem 1rem;border:none;border-radius:4px;font-size:.875rem;font-weight:500;cursor:pointer;transition:all .2s ease;display:inline-flex;align-items:center;gap:.5rem}.btn[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:not-allowed}.btn.btn-primary[_ngcontent-%COMP%]{background:#2d1674;color:#fff;box-shadow:0 2px 4px #0000000a}.btn.btn-primary[_ngcontent-%COMP%]:hover:not(:disabled){background:#1e0f52;box-shadow:0 4px 12px #2d167433;transform:translateY(-1px)}.btn.btn-secondary[_ngcontent-%COMP%]{background:#fff;color:#262626;border:1px solid #e5e7eb}.btn.btn-secondary[_ngcontent-%COMP%]:hover:not(:disabled){background:#0000000a;border-color:#9ca3af}.btn.btn-danger[_ngcontent-%COMP%]{background:#f56565;color:#fff;box-shadow:0 2px 4px #0000000a}.btn.btn-danger[_ngcontent-%COMP%]:hover:not(:disabled){background:#e53e3e;transform:translateY(-1px)}.btn.btn-sm[_ngcontent-%COMP%]{padding:.25rem .75rem;font-size:.75rem}.btn[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:.875rem}.modal-overlay[_ngcontent-%COMP%]{position:fixed;inset:0;background:#00000080;display:flex;align-items:center;justify-content:center;z-index:1040;-webkit-backdrop-filter:blur(4px);backdrop-filter:blur(4px);animation:_ngcontent-%COMP%_fadeIn .2s ease}.modal-content[_ngcontent-%COMP%]{background:#ffffffd9;border-radius:16px;max-width:800px;width:90%;max-height:90vh;overflow-y:auto;box-shadow:0 16px 48px #0000001a;animation:_ngcontent-%COMP%_slideUp .3s ease}.modal-content.modal-confirm[_ngcontent-%COMP%]{max-width:500px}.modal-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:1.5rem;border-bottom:1px solid #e5e7eb}.modal-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:1.5rem;font-weight:600;color:#262626;margin:0}.modal-header[_ngcontent-%COMP%]   .btn-close[_ngcontent-%COMP%]{background:transparent;border:none;font-size:1.5rem;cursor:pointer;color:#595959;padding:0;width:24px;height:24px;display:flex;align-items:center;justify-content:center;border-radius:4px;transition:.2s ease}.modal-header[_ngcontent-%COMP%]   .btn-close[_ngcontent-%COMP%]:hover{background:#0000000a;color:#262626}.modal-body[_ngcontent-%COMP%]{padding:1.5rem}.modal-footer[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:1rem;padding:1.5rem;border-top:1px solid #e5e7eb}.detail-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(2,1fr);gap:1.5rem}.detail-item[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.5rem}.detail-item.full-width[_ngcontent-%COMP%]{grid-column:1/-1}.detail-item[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-size:.75rem;font-weight:600;color:#595959;text-transform:uppercase;letter-spacing:.05em}.detail-item[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:1rem;color:#262626;font-weight:500}.detail-item[_ngcontent-%COMP%]   span.currency[_ngcontent-%COMP%]{font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace}.detail-item[_ngcontent-%COMP%]   span.currency.positive[_ngcontent-%COMP%]{color:#48bb78}.detail-item[_ngcontent-%COMP%]   span.currency.negative[_ngcontent-%COMP%]{color:#f56565}.detail-item[_ngcontent-%COMP%]   .notes[_ngcontent-%COMP%]{margin:0;padding:1rem;background:#fff;border-radius:4px;font-size:.875rem;line-height:1.5;white-space:pre-wrap;color:#262626}@media(max-width:1400px){.registers-table[_ngcontent-%COMP%]{font-size:.75rem}.registers-table[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .registers-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:.75rem}}@media(max-width:1024px){.registers-container[_ngcontent-%COMP%]{padding:1rem}.page-header[_ngcontent-%COMP%]{flex-direction:column;align-items:flex-start;gap:1rem}.page-header[_ngcontent-%COMP%]   .header-actions[_ngcontent-%COMP%]{width:100%;justify-content:flex-end}.filter-row[_ngcontent-%COMP%]{flex-direction:column;align-items:stretch}.filter-row[_ngcontent-%COMP%]   .filter-group[_ngcontent-%COMP%]{width:100%}.detail-grid[_ngcontent-%COMP%]{grid-template-columns:1fr}.table-container[_ngcontent-%COMP%]{overflow-x:auto}.registers-table[_ngcontent-%COMP%]{min-width:1200px}}@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0}to{opacity:1}}@keyframes _ngcontent-%COMP%_slideUp{0%{transform:translateY(20px);opacity:0}to{transform:translateY(0);opacity:1}}']})}}return s})()},8397:(I,b,o)=>{o.d(b,{f:()=>f});var i=o(1413),R=o(375);let f=(()=>{class _{constructor(){this.subject=new i.B,this._id=0}show(u,g="info",e=2e3){const a={id:++this._id,message:u,type:g,duration:e};return this.subject.next(a),a.id}onToast(){return this.subject.asObservable()}static{this.\u0275fac=function(g){return new(g||_)}}static{this.\u0275prov=R.jDH({token:_,factory:_.\u0275fac,providedIn:"root"})}}return _})()}}]);