<div class="search-results-container">
  <!-- Loading State -->
  <div class="loading-state" *ngIf="isLoading">
    <div class="spinner"></div>
    <p>{{ "SEARCH.SEARCHING" | translate }}</p>
  </div>

  <!-- Results List -->
  <div
    class="results-list"
    *ngIf="!isLoading && searchQuery() && products().length > 0"
  >
    <div class="results-header">
      <span class="results-count"
        >{{ products().length }} result{{ products().length !== 1 ? "s" : "" }}
        {{ "SEARCH.FOUND" | translate }}</span
      >
    </div>

    <div
      class="result-item"
      *ngFor="let product of products()"
      (click)="onProductClick(product)"
    >
      <div class="result-image">
        @if (product.local_image) {
        <img
          [src]="getProductImageUrl(product)"
          [alt]="product.name"
          (error)="
            $any($event.target).src =
              'data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%2260%22 height=%2260%22%3E%3Crect width=%2260%22 height=%2260%22 fill=%22%23f0f0f0%22/%3E%3Ctext x=%2230%22 y=%2237%22 text-anchor=%22middle%22 fill=%22%23999%22 font-size=%2224%22%3EðŸ“¦%3C/text%3E%3C/svg%3E'
          "
        />
        } @else {
        <div class="no-image">
          <i class="fas fa-box"></i>
        </div>
        }
      </div>

      <div class="result-info">
        <div class="result-name">{{ product.name }}</div>
        <div class="result-details">
          <span class="result-brand" *ngIf="product.brand">{{
            product.brand
          }}</span>
          <span class="result-code">{{ getProductCode(product) }}</span>
        </div>
        <div class="result-category" *ngIf="product.category">
          <i class="fas fa-tag"></i>
          {{ product.category }}
        </div>
      </div>

      <div class="result-price">
        <span class="price-amount">{{ product.price | appCurrency }}</span>
        <button class="btn-add-quick">
          <i class="fas fa-plus"></i>
        </button>
      </div>

      <button
        *ngIf="isAdmin()"
        class="btn-delete"
        (click)="openDeleteModal($event, product)"
        title="Delete product"
      >
        <i class="fas fa-trash"></i>
      </button>
    </div>
  </div>

  <!-- No Results -->
  <div
    class="no-results"
    *ngIf="!isLoading && searchQuery() && products().length === 0"
  >
    <i class="fas fa-search"></i>
    <h3>{{ "SEARCH.NO_RESULTS.TITLE" | translate }}</h3>
    <p>{{ "SEARCH.NO_RESULTS.DESCRIPTION" | translate }}</p>
  </div>

  <!-- Empty Search Placeholder -->
  <div class="empty-search" *ngIf="!isLoading && !searchQuery()">
    <i class="fas fa-search"></i>
    <h3>{{ "SEARCH.EMPTY.TITLE" | translate }}</h3>
    <p>{{ "SEARCH.EMPTY.DESCRIPTION" | translate }}</p>
  </div>
</div>

<!-- Delete Confirmation Modal -->
<div
  class="modal-overlay"
  *ngIf="showDeleteModal"
  (click)="closeDeleteModal()"
  (keydown)="onDeleteKeyDown($event)"
>
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>Delete Product</h3>
      <button class="close-btn" (click)="closeDeleteModal()">
        <i class="fas fa-times"></i>
      </button>
    </div>
    <div class="modal-body">
      <p>
        Are you sure you want to delete
        <strong>{{ productToDelete?.name }}</strong
        >?
      </p>
      <p class="warning">This action cannot be undone.</p>
    </div>
    <div class="modal-footer">
      <button class="btn-cancel" (click)="closeDeleteModal()">Cancel</button>
      <button class="btn-delete-confirm" (click)="confirmDelete()">
        <i class="fas fa-trash"></i> Delete
      </button>
    </div>
  </div>
</div>
